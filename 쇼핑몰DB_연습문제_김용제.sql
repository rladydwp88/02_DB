CREATE TABLE CATEGORIES (
	CATEGORY_ID NUMBER CONSTRAINT CT_ID_PK PRIMARY KEY,
	CATEGORY_NAME VARCHAR2(100) CONSTRAINT CT_NM_UNQ UNIQUE
);

CREATE TABLE PRODUCTS (
	PRODUCT_ID NUMBER CONSTRAINT PD_ID_PK PRIMARY KEY,
	PRODUCT_NAME VARCHAR(100) CONSTRAINT PD_NM_NN NOT NULL,
	CATEGORY NUMBER CONSTRAINT PD_CT_FK REFERENCES CATEGORIES(CATEGORY_ID),
	PRICE NUMBER DEFAULT 0,
	STOCK_QUANTITY NUMBER DEFAULT 0
);

CREATE TABLE CUSTOMERS (
	CUSTOMER_ID NUMBER CONSTRAINT CTM_ID_PK PRIMARY KEY,
	NAME VARCHAR2(20) CONSTRAINT NM_NN NOT NULL,
	GENDER CHAR(3) CONSTRAINT GEN_C CHECK (GENDER IN ('남', '여')),
	ADDRESS VARCHAR2(100),
	PHONE VARCHAR2(30)
);

CREATE TABLE ORDERS (
	ORDER_ID NUMBER CONSTRAINT OR_ID_PK PRIMARY KEY,
	ORDER_DATE DATE DEFAULT SYSDATE,
	STATUS CHAR(1) DEFAULT 'N' CONSTRAINT ST_C CHECK (STATUS IN ('Y','N')),
	CUSTOMER_ID NUMBER CONSTRAINT OR_CT_FK REFERENCES CUSTOMERS(CUSTOMER_ID) ON DELETE CASCADE
);

CREATE TABLE ORDER_DETAILS (
	ORDER_DETAIL_ID NUMBER CONSTRAINT ORD_ID_PK PRIMARY KEY,
	ORDER_ID NUMBER CONSTRAINT ORD_OR_FK REFERENCES ORDERS(ORDER_ID) ON DELETE CASCADE,
	PRODUCT_ID NUMBER CONSTRAINT ORD_PD_FK REFERENCES PRODUCTS(PRODUCT_ID) ON DELETE SET NULL,
	QYANTITY NUMBER,
	PRICE_PER_UNIT NUMBER
);

INSERT INTO CATEGORIES VALUES (1, '스마트폰');
INSERT INTO CATEGORIES VALUES (2, 'TV');
INSERT INTO CATEGORIES VALUES (3, 'Gaming');

INSERT INTO PRODUCTS VALUES (101, 'Apple iPhone 12', '1', '1500000', '30');
INSERT INTO PRODUCTS VALUES (102, 'Samsung Galaxy S24', '1', '1800000', '50');
INSERT INTO PRODUCTS VALUES (201, 'LG OLED TV', '2', '3600000', '10');
INSERT INTO PRODUCTS VALUES (301, 'Sony PlayStation 5', '3', '700000', '15');

INSERT INTO CUSTOMERS VALUES (1, '홍길동', '남', '서울시 성동구 왕십리', '010-1111-2222');
INSERT INTO CUSTOMERS VALUES (2, '유관순', '여', '서울시 종로구 안국동', '010-3333-1111');

INSERT INTO ORDERS VALUES (576, '2024-02-29', 'N', 1);
INSERT INTO ORDERS VALUES (978, '2024-03-11', 'Y', 2);
INSERT INTO ORDERS VALUES (777, '2024-03-11', 'N', 2);
INSERT INTO ORDERS VALUES (134, '2022-12-25', 'Y', 1);
INSERT INTO ORDERS VALUES (499, '2020-01-03', 'Y', 1);

INSERT INTO ORDER_DETAILS VALUES (111, 576, 101, 1, 1500000);
INSERT INTO ORDER_DETAILS VALUES (222, 978, 201, 2, 3600000);
INSERT INTO ORDER_DETAILS VALUES (333, 978, 102, 1, 1800000);
INSERT INTO ORDER_DETAILS VALUES (444, 777, 301, 5, 700000);
INSERT INTO ORDER_DETAILS VALUES (555, 134, 102, 1, 1800000);
INSERT INTO ORDER_DETAILS VALUES (666, 499, 201, 3, 3600000);

SELECT * FROM ORDER_DETAILS;

-- 1)
SELECT NAME 고객명, ORDER_DATE 주문일, STATUS 처리상태 FROM CUSTOMERS JOIN ORDERS USING(CUSTOMER_ID) WHERE STATUS = 'N';

-- 2)
SELECT ORDER_ID 주문번호, ORDER_DATE 주문날짜, STATUS 처리날짜 FROM CUSTOMERS JOIN ORDERS USING(CUSTOMER_ID) WHERE NAME = '홍길동' AND STATUS = 'N';

-- 3)
SELECT ORDER_ID 주문번호, PRODUCT_NAME 상품명, QYANTITY 수량, PRICE_PER_UNIT 개별금액, SUM(QYANTITY*PRICE_PER_UNIT) 주문별금액합계
FROM CUSTOMERS
JOIN ORDERS USING(CUSTOMER_ID)
JOIN ORDER_DETAILS USING(ORDER_ID)
JOIN PRODUCTS USING(PRODUCT_ID)
WHERE NAME = '유관순'
GROUP BY ORDER_ID, PRODUCT_NAME, QYANTITY, PRICE_PER_UNIT;